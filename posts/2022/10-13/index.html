<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="icon" href="/productivity-news/favicon/favicon.ico"/><link rel="icon" href="/productivity-news/favicon/icon.svg" type="image/svg+xml"/><link rel="apple-touch-icon" href="/productivity-news/favicon/apple-touch-icon.png"/><link rel="manifest" href="/productivity-news/favicon/site.webmanifest"/><meta name="theme-color" content="#000"/><meta property="og:image" content="https://cybozu.github.io/productivity-news/og-image.png"/><meta name="twitter:image" content="https://cybozu.github.io/productivity-news/twitter-card.png"/><meta name="twitter:card" content="summary_large_image"/><title>#5 - 2022.10.13 | Cybozu Productivity News</title><meta name="og:title" content="#5 - 2022.10.13 | Cybozu Productivity News"/><meta name="next-head-count" content="12"/><link rel="preload" href="/productivity-news/_next/static/css/e9b3e6a132e6efce.css" as="style"/><link rel="stylesheet" href="/productivity-news/_next/static/css/e9b3e6a132e6efce.css" data-n-g=""/><link rel="preload" href="/productivity-news/_next/static/css/236a9c0f78af5b56.css" as="style"/><link rel="stylesheet" href="/productivity-news/_next/static/css/236a9c0f78af5b56.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/productivity-news/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/productivity-news/_next/static/chunks/webpack-473f7a533704d3c7.js" defer=""></script><script src="/productivity-news/_next/static/chunks/framework-6fb3980f016be2d7.js" defer=""></script><script src="/productivity-news/_next/static/chunks/main-4f8d1876aae14607.js" defer=""></script><script src="/productivity-news/_next/static/chunks/pages/_app-1e17a6754614af77.js" defer=""></script><script src="/productivity-news/_next/static/chunks/72-915495b5abb2d97e.js" defer=""></script><script src="/productivity-news/_next/static/chunks/pages/posts/%5Byear%5D/%5Bslug%5D-6b5584d8c88e1283.js" defer=""></script><script src="/productivity-news/_next/static/8WEfGFQKsPmqm1N0_N-P_/_buildManifest.js" defer=""></script><script src="/productivity-news/_next/static/8WEfGFQKsPmqm1N0_N-P_/_ssgManifest.js" defer=""></script><script src="/productivity-news/_next/static/8WEfGFQKsPmqm1N0_N-P_/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div class="min-h-screen"><main><div class="container mx-auto px-5"><h2 class="text-2xl md:text-4xl font-bold tracking-tight md:tracking-tighter leading-tight mb-20 mt-8"><a class="hover:underline" href="/productivity-news/">Cybozu Productivity News</a></h2><article class="mb-32"><h1 class="text-5xl md:text-7xl lg:text-8xl font-bold tracking-tighter leading-tight md:leading-none mb-12 text-center md:text-left">#5 - 2022.10.13</h1><div class="max-w-full mx-auto"><div class="markdown-styles_markdown__h_8de"><h2><a href="https://github.blog/changelog/2022-09-01-github-actions-larger-runners-are-now-in-public-beta/">GitHub Actions でランナーのリソースを増強できる Larger runners がパブリックベータになりました</a></h2>
<p>共有担当: <a href="https://twitter.com/miyajan">@miyajan</a></p>
<ul>
<li>これまで GitHub が提供する Linux と Windows のランナーは CPU 2 コア、メモリ 7GB でした</li>
<li>Larger runners では CPU が最大 64 コア、メモリが最大 256 GB までリソースを増強できます</li>
<li>enterprise もしくは organization レベルでランナーグループを作成し、Larger runners の利用をコントロールできます
<ul>
<li>どの organization、どのリポジトリが利用可能かアクセスコントロールが可能です</li>
</ul>
</li>
<li>料金
<ul>
<li><a href="https://docs.github.com/en/billing/managing-billing-for-github-actions/about-billing-for-github-actions#per-minute-rates">使用するリソースの量に応じて利用料金も増えます</a></li>
<li>通常のランナーはパブリックリポジトリは無料になりますが、Larger runners はパブリックリポジトリでも無料になりません
<ul>
<li>パブリックリポジトリで Larger runners を利用すると、外部からのコミットによって想定外の利用料金になる可能性があるので気をつけましょう</li>
</ul>
</li>
<li>通常のランナーはライセンスの種類に応じて無料枠が存在しますが、Larger runners は無料枠の対象になりません</li>
</ul>
</li>
<li>パブリックベータ
<ul>
<li>利用するには<a href="https://github.com/features/github-hosted-runners/signup">サインアップページ</a>から申し込み、waitlist に登録する必要があります</li>
<li>GitHub Team か GitHub Enterprise Cloud プランの organization のみ利用可能です</li>
</ul>
</li>
<li>GitHub Enterprise Cloud の場合、ランナーに固定の IP レンジのアドレスが割り当てられるようにする機能も追加されてます</li>
<li>これまで大量のリソースが必要なジョブを実行するには、ジョブを分割して並列実行するか、AWS/GCP など外部リソースに処理を持っていくかするしかなかったですが、GitHub Actions の単独のランナーで実現できる選択肢が増え、嬉しい場面がありそうです</li>
</ul>
<h2><a href="https://github.blog/changelog/2022-09-08-github-actions-use-github_token-with-workflow_dispatch-and-repository_dispatch/">GitHub Actions の GITHUB_TOKEN で workflow_dispatch と repository_dispatch イベントのワークフローを呼び出せるようになりました</a></h2>
<p>共有担当: <a href="https://twitter.com/miyajan">@miyajan</a></p>
<ul>
<li>GitHub Actions のワークフロー実行時に自動で <code>GITHUB_TOKEN</code> というシークレットが割り当てられ、ワークフロー内で GitHub へアクセスするときに利用できます
<ul>
<li>例えば、<a href="https://github.com/actions/checkout">actions/checkout</a> アクションはデフォルトでこの <code>GITHUB_TOKEN</code> を使って認証してリポジトリをチェックアウトします</li>
</ul>
</li>
<li>これまでは、<code>GITHUB_TOKEN</code> で GitHub のイベントを発生させる操作を行ったときに、別ワークフローをトリガーしないようになっていました
<ul>
<li>例えば、<code>GITHUB_TOKEN</code> を使ってリポジトリにコミットを push しても、GitHub Actions の <code>on: push</code> イベントのワークフローは実行されません</li>
<li>これは、ユーザーが誤ってワークフローの無限ループを引き起こすのを防ぐ目的の制限です</li>
<li>なので、ワークフローから別のワークフローをトリガーしたい場合は、パーソナルアクセストークンなど別の認証方法でイベントを発生させる必要がありました</li>
</ul>
</li>
<li>今回の変更で、<code>GITHUB_TOKEN</code> を使って <code>workflow_dispatch</code> イベントや <code>repository_dispatch</code> イベントを引き起こしたときは、対応する GitHub Actions のワークフローがトリガーされるように緩和されました
<ul>
<li>これらのイベントは明示的にワークフローを呼び出すためのイベントなので、誤って無限ループを引き起こすリスクは低いと判断されたようです</li>
</ul>
</li>
<li>今回の修正により、パーソナルアクセストークンなど別の認証方法を用意せずに実現できるシナリオが増えそうです
<ul>
<li>例えば、ワークフローからコミットを作成して、CI ワークフローを <code>workflow_dispatch</code> イベントや <code>repository_dispatch</code> イベントで呼び出すようにするとか</li>
</ul>
</li>
</ul>
<h2><a href="https://zenn.dev/emiksk/articles/f45c5fd771e90a">gRPC サーバのビルドに Earthly を使ってみよう</a></h2>
<p>共有担当: <a href="https://twitter.com/emiksk0910">@emiksk0910</a></p>
<ul>
<li><a href="https://cybozu.github.io/productivity-news/posts/2022/07-14/">Cybozu Productivity News #4</a>でも紹介した OSS のビルドツール Earthly の入門記事を2つ書いたのでその紹介です</li>
<li>Go で書かれた gRPC サーバーを題材に Earthly を使ってスタブコードの生成やテスト、バイナリビルド、Dockerイメージの生成とプッシュを行う入門記事です</li>
<li>実例を基に Earthly の基本的な構文の説明をしています</li>
<li>Makefile + Docker といった感じの触り心地で、Dockerfile を書いたことがある人なら苦もなく使えるようになると思います</li>
<li>学習コストの低さ、コンテナ上でタスクを実行することによる可搬性と再現性<sup><a href="#user-content-fn-repeatability" id="user-content-fnref-repeatability" data-footnote-ref aria-describedby="footnote-label">1</a></sup>の高さ、キャッシュの仕組みの理解のしやすさなどが特徴です</li>
</ul>
<h2><a href="https://zenn.dev/emiksk/articles/ba3b0183c3f895">Earthly を GitHub Actions で使ってみよう</a></h2>
<p>共有担当: <a href="https://twitter.com/emiksk0910">@emiksk0910</a></p>
<ul>
<li>続いて前の記事で書いた Earthfile (Earthly のタスク定義ファイル) を題材に、Earthly を GitHub Actions で実行する方法を説明しています</li>
<li>内容の大部分は Earthly のキャッシュの仕組みについての説明になっています
<ul>
<li>inline cache: タスクの成果物としての Docker イメージをタスク実行のためのキャッシュに用いる</li>
<li>explicit cache: タスクの中間イメージをキャッシュのために別途リモートレジストリに保存し、それをタスク実行のためのキャッシュに用いる</li>
</ul>
</li>
<li>記事執筆のついでに複数のリモートキャッシュを読み込めるようにして、キャッシュの優先順位を設定できる <a href="https://github.com/earthly/earthly/pull/2063">Pull request</a> を Earthly 本体に出しました
<ul>
<li><a href="https://github.com/earthly/earthly/releases/tag/v0.6.22">v0.6.22</a>でリリースされています 🎉</li>
</ul>
</li>
<li><a href="https://docs.earthly.dev/earthly-cloud/satellites">Earthly Satellites</a> という Earthly を実行するためのリモートインスタンスを立ち上げて、そこでタスクを実行する機能もベータですが存在しています
<ul>
<li>同じ Satellite インスタンスを CI で用いることで、リモートではなくローカルのキャッシュをジョブに使えるようになります</li>
</ul>
</li>
<li>まだリリースされていませんが、Earthly CI なるものも計画されているようです</li>
<li>Earthly 便利なのでみなさんもぜひ使ってみてください</li>
</ul>
<hr>
<h1>We are hiring</h1>
<a href="https://note.com/cybozu_dev/n/n1c1b44bf72f6">
<img src="https://user-images.githubusercontent.com/471182/156986297-b189ef3d-98d3-4490-af5c-007a4ab47e5e.png" alt="サイボウズの開発者の生産性を上げる「生産性向上チーム」とは！？" width="600">
</a>
<section data-footnotes class="footnotes"><h2 id="footnote-label" class="sr-only">Footnotes</h2>
<ol>
<li id="user-content-fn-repeatability">
<p>Docker イメージを上手に作らないと再現性の高さは得られないことに注意してください。イメージをビルドする時に依存するライブラリのバージョンが不定だと容易に再現性が下がります。 <a href="#user-content-fnref-repeatability" data-footnote-backref class="data-footnote-backref" aria-label="Back to content">↩</a></p>
</li>
</ol>
</section>
</div></div></article></div></main></div><footer class="bg-neutral-50 border-t border-neutral-200"><div class="container mx-auto px-5"><div class="py-10 flex flex-col lg:flex-row items-center"><div class="flex flex-col lg:flex-row justify-center items-center lg:pl-4 lg:w-1/2"><a href="https://github.com/cybozu/productivity-news" class="mx-3 font-bold hover:underline">View on GitHub</a></div></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"#5 - 2022.10.13","year":"2022","slug":"10-13","content":"\u003ch2\u003e\u003ca href=\"https://github.blog/changelog/2022-09-01-github-actions-larger-runners-are-now-in-public-beta/\"\u003eGitHub Actions でランナーのリソースを増強できる Larger runners がパブリックベータになりました\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e共有担当: \u003ca href=\"https://twitter.com/miyajan\"\u003e@miyajan\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eこれまで GitHub が提供する Linux と Windows のランナーは CPU 2 コア、メモリ 7GB でした\u003c/li\u003e\n\u003cli\u003eLarger runners では CPU が最大 64 コア、メモリが最大 256 GB までリソースを増強できます\u003c/li\u003e\n\u003cli\u003eenterprise もしくは organization レベルでランナーグループを作成し、Larger runners の利用をコントロールできます\n\u003cul\u003e\n\u003cli\u003eどの organization、どのリポジトリが利用可能かアクセスコントロールが可能です\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e料金\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://docs.github.com/en/billing/managing-billing-for-github-actions/about-billing-for-github-actions#per-minute-rates\"\u003e使用するリソースの量に応じて利用料金も増えます\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e通常のランナーはパブリックリポジトリは無料になりますが、Larger runners はパブリックリポジトリでも無料になりません\n\u003cul\u003e\n\u003cli\u003eパブリックリポジトリで Larger runners を利用すると、外部からのコミットによって想定外の利用料金になる可能性があるので気をつけましょう\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e通常のランナーはライセンスの種類に応じて無料枠が存在しますが、Larger runners は無料枠の対象になりません\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eパブリックベータ\n\u003cul\u003e\n\u003cli\u003e利用するには\u003ca href=\"https://github.com/features/github-hosted-runners/signup\"\u003eサインアップページ\u003c/a\u003eから申し込み、waitlist に登録する必要があります\u003c/li\u003e\n\u003cli\u003eGitHub Team か GitHub Enterprise Cloud プランの organization のみ利用可能です\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eGitHub Enterprise Cloud の場合、ランナーに固定の IP レンジのアドレスが割り当てられるようにする機能も追加されてます\u003c/li\u003e\n\u003cli\u003eこれまで大量のリソースが必要なジョブを実行するには、ジョブを分割して並列実行するか、AWS/GCP など外部リソースに処理を持っていくかするしかなかったですが、GitHub Actions の単独のランナーで実現できる選択肢が増え、嬉しい場面がありそうです\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e\u003ca href=\"https://github.blog/changelog/2022-09-08-github-actions-use-github_token-with-workflow_dispatch-and-repository_dispatch/\"\u003eGitHub Actions の GITHUB_TOKEN で workflow_dispatch と repository_dispatch イベントのワークフローを呼び出せるようになりました\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e共有担当: \u003ca href=\"https://twitter.com/miyajan\"\u003e@miyajan\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eGitHub Actions のワークフロー実行時に自動で \u003ccode\u003eGITHUB_TOKEN\u003c/code\u003e というシークレットが割り当てられ、ワークフロー内で GitHub へアクセスするときに利用できます\n\u003cul\u003e\n\u003cli\u003e例えば、\u003ca href=\"https://github.com/actions/checkout\"\u003eactions/checkout\u003c/a\u003e アクションはデフォルトでこの \u003ccode\u003eGITHUB_TOKEN\u003c/code\u003e を使って認証してリポジトリをチェックアウトします\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eこれまでは、\u003ccode\u003eGITHUB_TOKEN\u003c/code\u003e で GitHub のイベントを発生させる操作を行ったときに、別ワークフローをトリガーしないようになっていました\n\u003cul\u003e\n\u003cli\u003e例えば、\u003ccode\u003eGITHUB_TOKEN\u003c/code\u003e を使ってリポジトリにコミットを push しても、GitHub Actions の \u003ccode\u003eon: push\u003c/code\u003e イベントのワークフローは実行されません\u003c/li\u003e\n\u003cli\u003eこれは、ユーザーが誤ってワークフローの無限ループを引き起こすのを防ぐ目的の制限です\u003c/li\u003e\n\u003cli\u003eなので、ワークフローから別のワークフローをトリガーしたい場合は、パーソナルアクセストークンなど別の認証方法でイベントを発生させる必要がありました\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e今回の変更で、\u003ccode\u003eGITHUB_TOKEN\u003c/code\u003e を使って \u003ccode\u003eworkflow_dispatch\u003c/code\u003e イベントや \u003ccode\u003erepository_dispatch\u003c/code\u003e イベントを引き起こしたときは、対応する GitHub Actions のワークフローがトリガーされるように緩和されました\n\u003cul\u003e\n\u003cli\u003eこれらのイベントは明示的にワークフローを呼び出すためのイベントなので、誤って無限ループを引き起こすリスクは低いと判断されたようです\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e今回の修正により、パーソナルアクセストークンなど別の認証方法を用意せずに実現できるシナリオが増えそうです\n\u003cul\u003e\n\u003cli\u003e例えば、ワークフローからコミットを作成して、CI ワークフローを \u003ccode\u003eworkflow_dispatch\u003c/code\u003e イベントや \u003ccode\u003erepository_dispatch\u003c/code\u003e イベントで呼び出すようにするとか\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e\u003ca href=\"https://zenn.dev/emiksk/articles/f45c5fd771e90a\"\u003egRPC サーバのビルドに Earthly を使ってみよう\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e共有担当: \u003ca href=\"https://twitter.com/emiksk0910\"\u003e@emiksk0910\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://cybozu.github.io/productivity-news/posts/2022/07-14/\"\u003eCybozu Productivity News #4\u003c/a\u003eでも紹介した OSS のビルドツール Earthly の入門記事を2つ書いたのでその紹介です\u003c/li\u003e\n\u003cli\u003eGo で書かれた gRPC サーバーを題材に Earthly を使ってスタブコードの生成やテスト、バイナリビルド、Dockerイメージの生成とプッシュを行う入門記事です\u003c/li\u003e\n\u003cli\u003e実例を基に Earthly の基本的な構文の説明をしています\u003c/li\u003e\n\u003cli\u003eMakefile + Docker といった感じの触り心地で、Dockerfile を書いたことがある人なら苦もなく使えるようになると思います\u003c/li\u003e\n\u003cli\u003e学習コストの低さ、コンテナ上でタスクを実行することによる可搬性と再現性\u003csup\u003e\u003ca href=\"#user-content-fn-repeatability\" id=\"user-content-fnref-repeatability\" data-footnote-ref aria-describedby=\"footnote-label\"\u003e1\u003c/a\u003e\u003c/sup\u003eの高さ、キャッシュの仕組みの理解のしやすさなどが特徴です\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e\u003ca href=\"https://zenn.dev/emiksk/articles/ba3b0183c3f895\"\u003eEarthly を GitHub Actions で使ってみよう\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e共有担当: \u003ca href=\"https://twitter.com/emiksk0910\"\u003e@emiksk0910\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e続いて前の記事で書いた Earthfile (Earthly のタスク定義ファイル) を題材に、Earthly を GitHub Actions で実行する方法を説明しています\u003c/li\u003e\n\u003cli\u003e内容の大部分は Earthly のキャッシュの仕組みについての説明になっています\n\u003cul\u003e\n\u003cli\u003einline cache: タスクの成果物としての Docker イメージをタスク実行のためのキャッシュに用いる\u003c/li\u003e\n\u003cli\u003eexplicit cache: タスクの中間イメージをキャッシュのために別途リモートレジストリに保存し、それをタスク実行のためのキャッシュに用いる\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e記事執筆のついでに複数のリモートキャッシュを読み込めるようにして、キャッシュの優先順位を設定できる \u003ca href=\"https://github.com/earthly/earthly/pull/2063\"\u003ePull request\u003c/a\u003e を Earthly 本体に出しました\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/earthly/earthly/releases/tag/v0.6.22\"\u003ev0.6.22\u003c/a\u003eでリリースされています 🎉\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://docs.earthly.dev/earthly-cloud/satellites\"\u003eEarthly Satellites\u003c/a\u003e という Earthly を実行するためのリモートインスタンスを立ち上げて、そこでタスクを実行する機能もベータですが存在しています\n\u003cul\u003e\n\u003cli\u003e同じ Satellite インスタンスを CI で用いることで、リモートではなくローカルのキャッシュをジョブに使えるようになります\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eまだリリースされていませんが、Earthly CI なるものも計画されているようです\u003c/li\u003e\n\u003cli\u003eEarthly 便利なのでみなさんもぜひ使ってみてください\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch1\u003eWe are hiring\u003c/h1\u003e\n\u003ca href=\"https://note.com/cybozu_dev/n/n1c1b44bf72f6\"\u003e\n\u003cimg src=\"https://user-images.githubusercontent.com/471182/156986297-b189ef3d-98d3-4490-af5c-007a4ab47e5e.png\" alt=\"サイボウズの開発者の生産性を上げる「生産性向上チーム」とは！？\" width=\"600\"\u003e\n\u003c/a\u003e\n\u003csection data-footnotes class=\"footnotes\"\u003e\u003ch2 id=\"footnote-label\" class=\"sr-only\"\u003eFootnotes\u003c/h2\u003e\n\u003col\u003e\n\u003cli id=\"user-content-fn-repeatability\"\u003e\n\u003cp\u003eDocker イメージを上手に作らないと再現性の高さは得られないことに注意してください。イメージをビルドする時に依存するライブラリのバージョンが不定だと容易に再現性が下がります。 \u003ca href=\"#user-content-fnref-repeatability\" data-footnote-backref class=\"data-footnote-backref\" aria-label=\"Back to content\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/section\u003e\n"}},"__N_SSG":true},"page":"/posts/[year]/[slug]","query":{"year":"2022","slug":"10-13"},"buildId":"8WEfGFQKsPmqm1N0_N-P_","assetPrefix":"/productivity-news","runtimeConfig":{"basePath":"/productivity-news"},"isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>