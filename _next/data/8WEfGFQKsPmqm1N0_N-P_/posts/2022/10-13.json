{"pageProps":{"post":{"title":"#5 - 2022.10.13","year":"2022","slug":"10-13","content":"<h2><a href=\"https://github.blog/changelog/2022-09-01-github-actions-larger-runners-are-now-in-public-beta/\">GitHub Actions でランナーのリソースを増強できる Larger runners がパブリックベータになりました</a></h2>\n<p>共有担当: <a href=\"https://twitter.com/miyajan\">@miyajan</a></p>\n<ul>\n<li>これまで GitHub が提供する Linux と Windows のランナーは CPU 2 コア、メモリ 7GB でした</li>\n<li>Larger runners では CPU が最大 64 コア、メモリが最大 256 GB までリソースを増強できます</li>\n<li>enterprise もしくは organization レベルでランナーグループを作成し、Larger runners の利用をコントロールできます\n<ul>\n<li>どの organization、どのリポジトリが利用可能かアクセスコントロールが可能です</li>\n</ul>\n</li>\n<li>料金\n<ul>\n<li><a href=\"https://docs.github.com/en/billing/managing-billing-for-github-actions/about-billing-for-github-actions#per-minute-rates\">使用するリソースの量に応じて利用料金も増えます</a></li>\n<li>通常のランナーはパブリックリポジトリは無料になりますが、Larger runners はパブリックリポジトリでも無料になりません\n<ul>\n<li>パブリックリポジトリで Larger runners を利用すると、外部からのコミットによって想定外の利用料金になる可能性があるので気をつけましょう</li>\n</ul>\n</li>\n<li>通常のランナーはライセンスの種類に応じて無料枠が存在しますが、Larger runners は無料枠の対象になりません</li>\n</ul>\n</li>\n<li>パブリックベータ\n<ul>\n<li>利用するには<a href=\"https://github.com/features/github-hosted-runners/signup\">サインアップページ</a>から申し込み、waitlist に登録する必要があります</li>\n<li>GitHub Team か GitHub Enterprise Cloud プランの organization のみ利用可能です</li>\n</ul>\n</li>\n<li>GitHub Enterprise Cloud の場合、ランナーに固定の IP レンジのアドレスが割り当てられるようにする機能も追加されてます</li>\n<li>これまで大量のリソースが必要なジョブを実行するには、ジョブを分割して並列実行するか、AWS/GCP など外部リソースに処理を持っていくかするしかなかったですが、GitHub Actions の単独のランナーで実現できる選択肢が増え、嬉しい場面がありそうです</li>\n</ul>\n<h2><a href=\"https://github.blog/changelog/2022-09-08-github-actions-use-github_token-with-workflow_dispatch-and-repository_dispatch/\">GitHub Actions の GITHUB_TOKEN で workflow_dispatch と repository_dispatch イベントのワークフローを呼び出せるようになりました</a></h2>\n<p>共有担当: <a href=\"https://twitter.com/miyajan\">@miyajan</a></p>\n<ul>\n<li>GitHub Actions のワークフロー実行時に自動で <code>GITHUB_TOKEN</code> というシークレットが割り当てられ、ワークフロー内で GitHub へアクセスするときに利用できます\n<ul>\n<li>例えば、<a href=\"https://github.com/actions/checkout\">actions/checkout</a> アクションはデフォルトでこの <code>GITHUB_TOKEN</code> を使って認証してリポジトリをチェックアウトします</li>\n</ul>\n</li>\n<li>これまでは、<code>GITHUB_TOKEN</code> で GitHub のイベントを発生させる操作を行ったときに、別ワークフローをトリガーしないようになっていました\n<ul>\n<li>例えば、<code>GITHUB_TOKEN</code> を使ってリポジトリにコミットを push しても、GitHub Actions の <code>on: push</code> イベントのワークフローは実行されません</li>\n<li>これは、ユーザーが誤ってワークフローの無限ループを引き起こすのを防ぐ目的の制限です</li>\n<li>なので、ワークフローから別のワークフローをトリガーしたい場合は、パーソナルアクセストークンなど別の認証方法でイベントを発生させる必要がありました</li>\n</ul>\n</li>\n<li>今回の変更で、<code>GITHUB_TOKEN</code> を使って <code>workflow_dispatch</code> イベントや <code>repository_dispatch</code> イベントを引き起こしたときは、対応する GitHub Actions のワークフローがトリガーされるように緩和されました\n<ul>\n<li>これらのイベントは明示的にワークフローを呼び出すためのイベントなので、誤って無限ループを引き起こすリスクは低いと判断されたようです</li>\n</ul>\n</li>\n<li>今回の修正により、パーソナルアクセストークンなど別の認証方法を用意せずに実現できるシナリオが増えそうです\n<ul>\n<li>例えば、ワークフローからコミットを作成して、CI ワークフローを <code>workflow_dispatch</code> イベントや <code>repository_dispatch</code> イベントで呼び出すようにするとか</li>\n</ul>\n</li>\n</ul>\n<h2><a href=\"https://zenn.dev/emiksk/articles/f45c5fd771e90a\">gRPC サーバのビルドに Earthly を使ってみよう</a></h2>\n<p>共有担当: <a href=\"https://twitter.com/emiksk0910\">@emiksk0910</a></p>\n<ul>\n<li><a href=\"https://cybozu.github.io/productivity-news/posts/2022/07-14/\">Cybozu Productivity News #4</a>でも紹介した OSS のビルドツール Earthly の入門記事を2つ書いたのでその紹介です</li>\n<li>Go で書かれた gRPC サーバーを題材に Earthly を使ってスタブコードの生成やテスト、バイナリビルド、Dockerイメージの生成とプッシュを行う入門記事です</li>\n<li>実例を基に Earthly の基本的な構文の説明をしています</li>\n<li>Makefile + Docker といった感じの触り心地で、Dockerfile を書いたことがある人なら苦もなく使えるようになると思います</li>\n<li>学習コストの低さ、コンテナ上でタスクを実行することによる可搬性と再現性<sup><a href=\"#user-content-fn-repeatability\" id=\"user-content-fnref-repeatability\" data-footnote-ref aria-describedby=\"footnote-label\">1</a></sup>の高さ、キャッシュの仕組みの理解のしやすさなどが特徴です</li>\n</ul>\n<h2><a href=\"https://zenn.dev/emiksk/articles/ba3b0183c3f895\">Earthly を GitHub Actions で使ってみよう</a></h2>\n<p>共有担当: <a href=\"https://twitter.com/emiksk0910\">@emiksk0910</a></p>\n<ul>\n<li>続いて前の記事で書いた Earthfile (Earthly のタスク定義ファイル) を題材に、Earthly を GitHub Actions で実行する方法を説明しています</li>\n<li>内容の大部分は Earthly のキャッシュの仕組みについての説明になっています\n<ul>\n<li>inline cache: タスクの成果物としての Docker イメージをタスク実行のためのキャッシュに用いる</li>\n<li>explicit cache: タスクの中間イメージをキャッシュのために別途リモートレジストリに保存し、それをタスク実行のためのキャッシュに用いる</li>\n</ul>\n</li>\n<li>記事執筆のついでに複数のリモートキャッシュを読み込めるようにして、キャッシュの優先順位を設定できる <a href=\"https://github.com/earthly/earthly/pull/2063\">Pull request</a> を Earthly 本体に出しました\n<ul>\n<li><a href=\"https://github.com/earthly/earthly/releases/tag/v0.6.22\">v0.6.22</a>でリリースされています 🎉</li>\n</ul>\n</li>\n<li><a href=\"https://docs.earthly.dev/earthly-cloud/satellites\">Earthly Satellites</a> という Earthly を実行するためのリモートインスタンスを立ち上げて、そこでタスクを実行する機能もベータですが存在しています\n<ul>\n<li>同じ Satellite インスタンスを CI で用いることで、リモートではなくローカルのキャッシュをジョブに使えるようになります</li>\n</ul>\n</li>\n<li>まだリリースされていませんが、Earthly CI なるものも計画されているようです</li>\n<li>Earthly 便利なのでみなさんもぜひ使ってみてください</li>\n</ul>\n<hr>\n<h1>We are hiring</h1>\n<a href=\"https://note.com/cybozu_dev/n/n1c1b44bf72f6\">\n<img src=\"https://user-images.githubusercontent.com/471182/156986297-b189ef3d-98d3-4490-af5c-007a4ab47e5e.png\" alt=\"サイボウズの開発者の生産性を上げる「生産性向上チーム」とは！？\" width=\"600\">\n</a>\n<section data-footnotes class=\"footnotes\"><h2 id=\"footnote-label\" class=\"sr-only\">Footnotes</h2>\n<ol>\n<li id=\"user-content-fn-repeatability\">\n<p>Docker イメージを上手に作らないと再現性の高さは得られないことに注意してください。イメージをビルドする時に依存するライブラリのバージョンが不定だと容易に再現性が下がります。 <a href=\"#user-content-fnref-repeatability\" data-footnote-backref class=\"data-footnote-backref\" aria-label=\"Back to content\">↩</a></p>\n</li>\n</ol>\n</section>\n"}},"__N_SSG":true}